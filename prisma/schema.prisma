generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SUPERADMIN // President
  ADMIN // Vice President or Secretary
  ACCOUNTING // Treasurer or Auditor
  USER // Resident
}

model User {
  id            String    @id
  email         String    @unique
  name          String?
  emailVerified Boolean   @default(false)
  image         String?
  role          Role      @default(USER)
  isArchived    Boolean   @default(false)
  isApproved    Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt
  sessions      Session[]
  accounts      Account[]
  amenityReservations AmenityReservation[]
  systemLogs    SystemLog[]
  feedbacks     Feedback[]
  contactReplies ContactReply[]

  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}

model Maps {
  id            String   @id @default(uuid())
  blockNo       String
  lotNo         String?
  street        String
  lotSize       Float
  houseType     String
  minPrice      Float
  maxPrice      Float
  paymentMethod String
  attachmentUrl String
  availability  String
  notes         String?
  residents     Resident[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt

  @@map("maps")
}

enum UserType {
  RESIDENT
  TENANT
  VISITOR
}

enum AmenityType {
  COURT
  GAZEBO
  PARKING_AREA
}

enum ReservationStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

model AmenityReservation {
  id            String            @id @default(uuid())
  userType      UserType
  userId        String?
  user          User?              @relation(fields: [userId], references: [id], onDelete: SetNull)
  fullName      String
  email         String?
  amenity       AmenityType
  date          DateTime
  startTime     String
  endTime       String
  numberOfGuests Int
  purpose       String?
  paymentMethod PaymentMethod?
  amountToPay   Float
  amountPaid    Float              @default(0)
  status        ReservationStatus  @default(PENDING)
  rejectionRemarks String?
  receiptUrl    String?
  proofOfPayment String?
  isArchived    Boolean            @default(false)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @default(now()) @updatedAt

  @@map("amenity_reservation")
}

enum AnnouncementCategory {
  IMPORTANT
  EMERGENCY
  UTILITIES
  OTHER
}

enum PublicationStatus {
  PUBLISHED
  DRAFT
}

model Announcement {
  id              String              @id @default(uuid())
  title           String
  category        AnnouncementCategory
  isForAll        Boolean             @default(true)
  description     String              @db.Text
  attachment      String?
  schedule        DateTime?
  isPin           Boolean             @default(false)
  publication     PublicationStatus   @default(DRAFT)
  isArchived      Boolean             @default(false)
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @default(now()) @updatedAt

  @@map("announcement")
}

enum VehicleType {
  SEDAN
  SUV
  TRUCK
  MOTORCYCLE
}

enum RelationshipToVehicle {
  OWNER
  FAMILY_MEMBER
  COMPANY_DRIVER
}

enum VehicleRegistrationStatus {
  PENDING
  APPROVED
  REJECTED
}

model VehicleRegistration {
  id                  String                  @id @default(uuid())
  brand               String
  model               String
  yearOfManufacture   Int
  color               String
  plateNumber         String
  vehicleType         VehicleType
  licenseNumber       String
  expiryDate          DateTime
  relationshipToVehicle RelationshipToVehicle
  orAttachment        String?
  crAttachment        String?
  paymentMethod       PaymentMethod?
  proofOfPayment      String?
  residentId          String?
  resident            Resident?              @relation(fields: [residentId], references: [id], onDelete: SetNull)
  status              VehicleRegistrationStatus @default(PENDING)
  isArchived          Boolean                 @default(false)
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @default(now()) @updatedAt

  @@map("vehicle_registration")
}

enum ResidencyType {
  RESIDENT
  TENANT
}

enum Sex {
  MALE
  FEMALE
  PREFER_NOT_TO_SAY
}

model Resident {
  id                  String                  @id @default(uuid())
  typeOfResidency     ResidencyType
  firstName           String
  middleName          String?
  lastName            String
  suffix              String?
  sex                 Sex
  dateOfBirth         DateTime
  contactNumber       String
  emailAddress        String?
  isArchived          Boolean                 @default(false)
  isHead              Boolean                 @default(false)
  mapId               String?
  map                 Maps?                   @relation(fields: [mapId], references: [id], onDelete: SetNull)
  vehicleRegistrations VehicleRegistration[]
  monthlyDues         MonthlyDue[]
  paymentTransactions PaymentTransaction[]
  feedbacks           Feedback[]
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @default(now()) @updatedAt

  @@map("resident")
}

enum PaymentMethod {
  CASH
  GCASH
  MAYA
  OTHER_BANK
}

enum MonthlyDueStatus {
  PENDING
  APPROVED
  REJECTED
}

model MonthlyDue {
  id            String        @id @default(uuid())
  residentId    String
  resident      Resident      @relation(fields: [residentId], references: [id], onDelete: Cascade)
  month         Int           // 1-12 (January to December)
  year          Int           // e.g., 2024
  amountPaid    Float         @default(0)
  paymentMethod PaymentMethod?
  notes         String?       @db.Text
  attachment    String?
  status        MonthlyDueStatus @default(PENDING)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now()) @updatedAt
  transactions  PaymentTransaction[]

  @@unique([residentId, month, year])
  @@map("monthly_due")
}

model PaymentTransaction {
  id            String        @id @default(uuid())
  monthlyDueId  String?
  monthlyDue    MonthlyDue?   @relation(fields: [monthlyDueId], references: [id], onDelete: SetNull)
  residentId    String
  resident      Resident      @relation(fields: [residentId], references: [id], onDelete: Cascade)
  amount        Float         // Amount paid in this transaction
  paymentMethod PaymentMethod?
  notes         String?       @db.Text
  proofOfPayment String?      // Attachment URL
  status        MonthlyDueStatus @default(PENDING)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now()) @updatedAt

  @@map("payment_transaction")
}

enum LogAction {
  CREATE
  UPDATE
  DELETE
  ARCHIVE
  RETRIEVE
  LOGIN
  LOGOUT
  PASSWORD_CHANGE
  PROFILE_UPDATE
  STATUS_CHANGE
  PAYMENT_CREATE
  PAYMENT_UPDATE
  PAYMENT_DELETE
}

enum LogModule {
  ACCOUNTS
  RESIDENTS
  VEHICLE_REGISTRATIONS
  ANNOUNCEMENTS
  AMENITY_RESERVATIONS
  MAPS
  MONTHLY_DUES
  SETTINGS
  AUTH
}

enum FeedbackCategory {
  GENERAL
  AMENITIES
  SECURITY
  BILLING
  EVENT
  SUGGESTION
  OTHER
}

enum FeedbackStatus {
  NEW
  IN_REVIEW
  RESOLVED
}

model Feedback {
  id            String          @id @default(uuid())
  residentName  String
  contactEmail  String?
  contactNumber String?
  subject       String
  message       String          @db.Text
  category      FeedbackCategory
  status        FeedbackStatus  @default(NEW)
  rating        Int?
  allowFollowUp Boolean         @default(true)
  residentId    String?
  resident      Resident?       @relation(fields: [residentId], references: [id], onDelete: SetNull)
  userId        String?
  user          User?           @relation(fields: [userId], references: [id], onDelete: SetNull)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @default(now()) @updatedAt

  @@index([category])
  @@index([status])
  @@map("feedback")
}

model SystemLog {
  id          String    @id @default(uuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  action      LogAction
  module      LogModule
  entityId    String?   // ID of the affected entity (e.g., resident ID, account ID)
  entityType  String?   // Type of entity (e.g., "Resident", "Account", "MonthlyDue")
  description String    @db.Text
  metadata    Json?    // Additional data as JSON
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime  @default(now())

  @@index([userId])
  @@index([module])
  @@index([action])
  @@index([createdAt])
  @@map("system_log")
}

enum WhatsNewType {
  BLOG
  NEWS
  GO_TO_PLACES
  MEDIA_HUB
}

enum WhatsNewCategory {
  INVESTMENT
  TRAVEL
  SHOPPING
  FOOD
  LIFESTYLE
  TECHNOLOGY
  HEALTH
  EDUCATION
  ENTERTAINMENT
  OTHER
}

model WhatsNew {
  id          String        @id @default(uuid())
  title       String
  description String        @db.Text
  type        WhatsNewType
  category    WhatsNewCategory?
  content     String?       @db.Text // Full content for detailed view (rich text HTML)
  imageUrl    String?
  attachmentUrl String?
  publication PublicationStatus @default(DRAFT)
  isFeatured  Boolean       @default(false)
  isArchived  Boolean       @default(false)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @default(now()) @updatedAt

  @@index([type])
  @@index([category])
  @@index([publication])
  @@index([isFeatured])
  @@index([isArchived])
  @@map("whats_new")
}

enum ContactStatus {
  NEW
  IN_PROGRESS
  RESOLVED
  CLOSED
}

model Contact {
  id            String        @id @default(uuid())
  fullName      String
  email         String
  phoneNumber   String?
  subject       String
  message       String        @db.Text
  status        ContactStatus @default(NEW)
  isArchived    Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now()) @updatedAt
  replies       ContactReply[]

  @@index([status])
  @@index([isArchived])
  @@index([createdAt])
  @@map("contact")
}

model ContactReply {
  id        String   @id @default(uuid())
  contact   Contact  @relation(fields: [contactId], references: [id], onDelete: Cascade)
  contactId String
  admin     User?    @relation(fields: [adminId], references: [id])
  adminId   String?
  message   String   @db.Text
  createdAt DateTime @default(now())

  @@index([contactId])
  @@index([adminId])
  @@map("contact_reply")
}
